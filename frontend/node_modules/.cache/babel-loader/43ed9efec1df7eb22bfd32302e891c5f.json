{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/admin/PycharmProjects/dz_trvp/trvp_dz/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/admin/PycharmProjects/dz_trvp/trvp_dz/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/admin/PycharmProjects/dz_trvp/trvp_dz/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import TextField from'@mui/material/TextField';import Paper from'@mui/material/Paper';import Button from'@mui/material/Button';import Select from'@mui/material/Select';import MenuItem from'@mui/material/MenuItem';import axios from'../../axios';import styles from'./AddDish.module.scss';import{useSelector}from\"react-redux\";import{selectIsAuth}from\"../../redux/slices/auth\";import{Navigate,useNavigate,useParams}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var AddDish=function AddDish(){var _useParams=useParams(),id=_useParams.id;var isAuth=useSelector(selectIsAuth);var _useState=useState(''),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),typeId=_useState4[0],setTypeId=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),image=_useState6[0],setImage=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),imagePreview=_useState8[0],setImagePreview=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),typeList=_useState10[0],setTypeList=_useState10[1];var navigate=useNavigate();var isEditing=Boolean(id);useEffect(function(){// Получение списка типов блюд с сервера\naxios.get('/types').then(function(response){setTypeList(response.data);});},[]);React.useEffect(function(){if(id){axios.get(\"/dishes/\".concat(id)).then(function(_ref){var data=_ref.data;setName(data.name);setImage(\"http://localhost:4444\".concat(data.avatarUrl));setTypeId(data.typeId._id);});}},[]);var handleImageChange=function handleImageChange(e){var file=e.target.files[0];if(file){setImage(file);setImagePreview(URL.createObjectURL(file));}};var handleCreateDish=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var avatarUrl,formData,imageResponse,requestData,_ref3,data,_id;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!(!name||!typeId)){_context.next=4;break;}alert('Укажите наименование блюда и тип блюда');return _context.abrupt(\"return\");case 4:avatarUrl=null;// Если есть изображение, загружаем его на сервер и получаем URL\nif(!image){_context.next=12;break;}formData=new FormData();formData.append('image',image);// Отправляем изображение на сервер\n_context.next=10;return axios.post('/upload',formData,{headers:{'Content-Type':'multipart/form-data'}});case 10:imageResponse=_context.sent;// Получаем URL изображения из ответа сервера\navatarUrl=imageResponse.data.url;case 12:// Формируем данные для запроса создания блюда\nrequestData={name:name,typeId:typeId,avatarUrl:avatarUrl};if(!isEditing){_context.next=19;break;}_context.next=16;return axios.patch(\"/dishes/\".concat(id),requestData);case 16:_context.t0=_context.sent;_context.next=22;break;case 19:_context.next=21;return axios.post('/dishes',requestData);case 21:_context.t0=_context.sent;case 22:_ref3=_context.t0;data=_ref3.data;_id=isEditing?id:data._id;navigate(\"/dish/\".concat(_id));// Отправка данных на сервер для создания блюда\n// const response = await axios.post('/dishes', requestData);\n//\n//\n// console.log('Блюдо успешно создано:', response.data);\n// setName('');\n// setTypeId('');\n// setImage(null);\n// setImagePreview('');\n// const fileInput = document.getElementById('imageInput');\n// if (fileInput) {\n//     fileInput.value = '';\n// }\n_context.next=33;break;case 28:_context.prev=28;_context.t1=_context[\"catch\"](0);console.error('Ошибка при создании блюда:',_context.t1);if(_context.t1.response){console.error('Ответ сервера:',_context.t1.response.data);}alert(_context.t1.response.data.message);case 33:case\"end\":return _context.stop();}}},_callee,null,[[0,28]]);}));return function handleCreateDish(){return _ref2.apply(this,arguments);};}();if(!window.localStorage.getItem('token')&&!isAuth){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(Paper,{style:{padding:30},children:[/*#__PURE__*/_jsx(TextField,{classes:{root:styles.title},variant:\"standard\",placeholder:\"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0431\\u043B\\u044E\\u0434\\u0430...\",fullWidth:true,value:name,onChange:function onChange(e){return setName(e.target.value);}}),/*#__PURE__*/_jsxs(Select,{style:{marginBottom:15},value:typeId,onChange:function onChange(e){return setTypeId(e.target.value);},displayEmpty:true,fullWidth:true,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",disabled:true,children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0442\\u0438\\u043F \\u0431\\u043B\\u044E\\u0434\\u0430\"}),typeList.map(function(type){return/*#__PURE__*/_jsx(MenuItem,{value:type._id,children:type.name},type.id);})]}),/*#__PURE__*/_jsx(\"input\",{style:{marginBottom:15},type:\"file\",onChange:handleImageChange,id:\"imageInput\"// Добавленный идентификатор для элемента input\n}),imagePreview&&/*#__PURE__*/_jsx(\"img\",{src:imagePreview,alt:\"Image Preview\"}),/*#__PURE__*/_jsxs(\"div\",{className:styles.buttons,children:[/*#__PURE__*/_jsx(Button,{size:\"large\",variant:\"contained\",onClick:handleCreateDish,children:isEditing?'Сохранить':'Создать блюдо'}),/*#__PURE__*/_jsx(\"a\",{href:\"/\",children:/*#__PURE__*/_jsx(Button,{size:\"large\",children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"})})]})]});};","map":{"version":3,"names":["React","useState","useEffect","TextField","Paper","Button","Select","MenuItem","axios","styles","useSelector","selectIsAuth","Navigate","useNavigate","useParams","AddDish","id","isAuth","name","setName","typeId","setTypeId","image","setImage","imagePreview","setImagePreview","typeList","setTypeList","navigate","isEditing","Boolean","get","then","response","data","avatarUrl","_id","handleImageChange","e","file","target","files","URL","createObjectURL","handleCreateDish","alert","formData","FormData","append","post","headers","imageResponse","url","requestData","patch","console","error","message","window","localStorage","getItem","padding","root","title","value","marginBottom","map","type","buttons"],"sources":["C:/Users/admin/PycharmProjects/dz_trvp/trvp_dz/frontend/src/pages/AddDish/index.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport TextField from '@mui/material/TextField';\r\nimport Paper from '@mui/material/Paper';\r\nimport Button from '@mui/material/Button';\r\nimport Select from '@mui/material/Select';\r\nimport MenuItem from '@mui/material/MenuItem';\r\nimport axios from '../../axios';\r\n\r\nimport styles from './AddDish.module.scss';\r\nimport {useSelector} from \"react-redux\";\r\nimport {selectIsAuth} from \"../../redux/slices/auth\";\r\nimport {Navigate, useNavigate, useParams} from \"react-router-dom\";\r\n\r\nexport const AddDish = () => {\r\n    const {id} = useParams();\r\n    const isAuth = useSelector(selectIsAuth);\r\n    const [name, setName] = useState('');\r\n    const [typeId, setTypeId] = useState('');\r\n    const [image, setImage] = useState(null);\r\n    const [imagePreview, setImagePreview] = useState('');\r\n    const [typeList, setTypeList] = useState([]);\r\n    const navigate = useNavigate();\r\n\r\n    const isEditing = Boolean(id);\r\n    useEffect(() => {\r\n        // Получение списка типов блюд с сервера\r\n        axios.get('/types').then((response) => {\r\n            setTypeList(response.data);\r\n        });\r\n    }, []);\r\n\r\n    React.useEffect(() => {\r\n        if(id) {\r\n            axios.get(`/dishes/${id}`).then(({data}) => {\r\n                setName(data.name);\r\n                setImage(`http://localhost:4444${data.avatarUrl}`);\r\n                setTypeId(data.typeId._id);\r\n            })\r\n        }\r\n    }, [])\r\n\r\n    const handleImageChange = (e) => {\r\n        const file = e.target.files[0];\r\n        if (file) {\r\n            setImage(file);\r\n            setImagePreview(URL.createObjectURL(file));\r\n        }\r\n    };\r\n\r\n    const handleCreateDish = async () => {\r\n        try {\r\n            if (!name || !typeId) {\r\n                alert('Укажите наименование блюда и тип блюда');\r\n                return;\r\n            }\r\n\r\n            let avatarUrl = null;\r\n\r\n            // Если есть изображение, загружаем его на сервер и получаем URL\r\n            if (image) {\r\n                const formData = new FormData();\r\n                formData.append('image', image);\r\n\r\n                // Отправляем изображение на сервер\r\n                const imageResponse = await axios.post('/upload', formData, {\r\n                    headers: {\r\n                        'Content-Type': 'multipart/form-data',\r\n                    },\r\n                });\r\n\r\n                // Получаем URL изображения из ответа сервера\r\n                avatarUrl = imageResponse.data.url;\r\n            }\r\n\r\n            // Формируем данные для запроса создания блюда\r\n            const requestData = {\r\n                name: name,\r\n                typeId: typeId,\r\n                avatarUrl: avatarUrl,\r\n            };\r\n\r\n            const {data} = isEditing\r\n                ? await axios.patch(`/dishes/${id}`, requestData)\r\n                : await axios.post('/dishes', requestData);\r\n\r\n            const _id = isEditing ? id : data._id;\r\n            navigate(`/dish/${_id}`)\r\n\r\n            // Отправка данных на сервер для создания блюда\r\n            // const response = await axios.post('/dishes', requestData);\r\n            //\r\n            //\r\n            // console.log('Блюдо успешно создано:', response.data);\r\n            // setName('');\r\n            // setTypeId('');\r\n            // setImage(null);\r\n            // setImagePreview('');\r\n            // const fileInput = document.getElementById('imageInput');\r\n            // if (fileInput) {\r\n            //     fileInput.value = '';\r\n            // }\r\n        } catch (error) {\r\n            console.error('Ошибка при создании блюда:', error);\r\n            if (error.response) {\r\n                console.error('Ответ сервера:', error.response.data);\r\n            }\r\n            alert(error.response.data.message)\r\n\r\n        }\r\n    };\r\n\r\n\r\n    if(!window.localStorage.getItem('token') && !isAuth) {\r\n        return <Navigate to=\"/\" />\r\n    }\r\n\r\n    return (\r\n        <Paper style={{ padding: 30 }}>\r\n            <TextField\r\n                classes={{ root: styles.title }}\r\n                variant=\"standard\"\r\n                placeholder=\"Название блюда...\"\r\n                fullWidth\r\n                value={name}\r\n                onChange={(e) => setName(e.target.value)}\r\n            />\r\n            {/* Выбор типа блюда */}\r\n            <Select style={{ marginBottom: 15 }}\r\n                value={typeId}\r\n                onChange={(e) => setTypeId(e.target.value)}\r\n                displayEmpty\r\n                fullWidth\r\n            >\r\n                <MenuItem value=\"\" disabled>\r\n                    Выберите тип блюда\r\n                </MenuItem>\r\n                {typeList.map((type) => (\r\n                    <MenuItem key={type.id} value={type._id}>\r\n                        {type.name}\r\n                    </MenuItem>\r\n                ))}\r\n            </Select>\r\n            {/* Загрузка изображения блюда */}\r\n            <input style={{ marginBottom: 15 }}\r\n                type=\"file\"\r\n                onChange={handleImageChange}\r\n                id=\"imageInput\"  // Добавленный идентификатор для элемента input\r\n            />\r\n            {imagePreview && <img src={imagePreview} alt=\"Image Preview\" />}\r\n            <div className={styles.buttons}>\r\n                <Button size=\"large\" variant=\"contained\" onClick={handleCreateDish}>\r\n                    {isEditing ? 'Сохранить' : 'Создать блюдо'}\r\n                </Button>\r\n                <a href=\"/\">\r\n                    <Button size=\"large\">Отмена</Button>\r\n                </a>\r\n            </div>\r\n        </Paper>\r\n    );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}